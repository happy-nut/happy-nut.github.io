# 멀티 테스킹과 멀티 프로세싱

멀티 테스킹은 프로세서 하나가 여러 프로세스의 실행 코드들을 작업 분할하여 빠르게 교차하며 실행하는 기술이다.
그래서 마치 사람의 눈에는 여러 작업을 동시에 실행하는 것처럼 보임. 
멀티 프로세싱은 둘 이상의 프로세서를 사용해서 여러 작업을 동시헤 처리하는 기술이다.

## 프로세스

프로세스는 운영체제에 실행 중인 프로그램이다.
프로세스마다 격리된 메모리 공간을 할당 받는데, 메모리 구성은 다음과 같다.

- 코드 섹션: 실행한 프로그램의 코드가 저장되는 부분
- 데이터 섹션: 데이터 섹션: 전역 변수 및 정적 변수가 저장되는 부분
- 힙: 동적으로 할당되는 메모리 영역
- 스택: 메소드 호출 시 생성되는 지역 변수와 반환 주소가 저장되는 영역(스레드에 귀속)

## 스레드

모든 프로세스는 반드시 하나 이상의 스레드를 포함한다. CPU를 사용해서 코드를 하나하나 실행하는 것은 스레드이기 때문이다.
프로세스 안에서 스레드가 하나면 싱글 스레드라 하고, 여러 개면 멀티 스레드라고 한다.
스레드는 프로세스 내애서의 자원(코드, 데이터, 시스템 자원)을 공유한다.


## 스케줄링

운영체제는 내부에 스케줄링 큐를 가지고 있다. 운영체제 안에 여러 프로세스가 구동 중일 것이고, 그 프로세스는 내부적으로 여러 스레드를 가지고 있을 것이다.
이 때 큐에 이런 실행되어야 하는 스레드들을 가지고 있다가 CPU에 올리게 된다. 당연히 계속 점유하게끔 내버려두진 않고, 스레드가 종료되지 않더라도
꺼내서 다시 큐에 넣게 되는데, 이러한 일련의 분할과 최적화 과정을 운영체제의 스케줄링이라고 한다.

멀티테스킹이 반드시 효율적인 것만은 아닌데, 그 이유는 컨텍스트 스위칭 비용이 발생하기 때문이다.
스레드 A를 멈추고 큐에 넣은 뒤 스레드 B를 CPU에 올리는 과정에서 CPU에서 사용하던 값들을 메모리에 저장해두었다가,
나중에 스레드 A가 재개될 때 다시 불러올 수 있어야 한다. 이 때문에 컨텍스트 스위칭에는 비용이 발생한다.

실제로 컨텍스트 스위칭에 걸리는 시간은 아주 짧지만, 스레드가 매우 많다면 이 비용이 커질 수 있으므로,
멀티스레드가 대부분의 상황에서 효율적이나 항상 그런 것만은 아니라는 걸 주의해야 한다.

## 스레드의 숫자 결정

스레드의 숫자는 CPU bounded 작업이 많은지, I/O bounded 작업이 많은지에 따라 달라진다.
CPU bounded 작업이 많다면 CPU의 코어 수에 맞춰 스레드를 생성하는 것이 좋다.
I/O bounded 작업이 많다면 스레드의 숫자를 CPU 코어 수보다 훨씬 많이 생성하는 것이 좋다.
I/O bounded 작업은 CPU를 사용하지 않고 대기하는 시간이 많기 때문에, 스레드가 많을수록 CPU를 더 잘 활용할 수 있다.
그렇지만 너무 많은 스레드를 생성하면 컨텍스트 스위칭 비용이 커지므로, 성능 테스트를 통해 적절한 숫자를 찾아야 한다.

