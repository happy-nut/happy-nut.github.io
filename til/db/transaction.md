# 트랜잭션(Transaction)

데이터베이스에서 트랜잭션은 하나의 논리적 작업 단위를 의미한다. 핵심은 여러 작업을 하나로 묶었을 때, 모두 성공하거나 모두 실패하도록 보장하는 것이다.
중간에 실패한 연산이 들어간 채로 커밋되어 버리면 데이터 부정합 문제가 생길 수 있기 때문이다.

## ACID

트랜잭션은 ACID 속성을 만족해야 한다. ACID는 다음과 같은 네 가지 속성을 의미한다.

- **원자성(Atomicity)**: 트랜잭션 내의 모든 작업이 성공적으로 완료되거나, 하나도 완료되지 않아야 한다. 즉, 트랜잭션은 "모두 또는 아무것도"의 원칙을 따른다.
- **일관성(Consistency)**: 트랜잭션이 완료되면 데이터베이스는 일관된 상태를 유지해야 한다. 즉, 트랜잭션 전후로 데이터의 무결성이 보장되어야 한다.
- **격리성(Isolation)**: 트랜잭션은 서로 독립적으로 실행되어야 한다. 즉, 동시에 실행되는 트랜잭션이 서로의 작업에 영향을 주지 않아야 한다.
- **지속성(Durability)**: 트랜잭션이 성공적으로 완료되면 그 결과는 영구적으로 저장되어야 한다. 즉, 시스템 장애가 발생하더라도 완료된 트랜잭션의 결과는 손실되지 않아야 한다.

항상 ACID 속성을 만족할 수는 없다. 예를 들어, 높은 동시성을 요구하는 시스템에서는 격리성을 낮추고 성능을 높이는 방향으로 트랜잭션을 설계할 수 있다.
이에 따라 [격리 레벨](rdbms/isolation-level)이라는 개념이 등장한다.

## 예시

```sql
BEGIN TRANSACTION;
UPDATE account SET balance = balance - 100000 WHERE id = 'A';
UPDATE account SET balance = balance + 100000 WHERE id = 'B';
COMMIT; -- 모든 작업이 성공하면 커밋
-- 또는 ROLLBACK; -- 문제가 있으면 롤백
```

`BEGIN TRANSACTION`으로 트랜잭션을 시작하고, 여러 작업을 수행한 후 `COMMIT`으로 커밋하는데,
그 사이에 있는 트랜잭션은 너무 크거나 작지 않도록 조정해야 한다.

너무 크다면 락 경합이 자주 생겨 성능 저하가 발생할 것이고, 너무 작다면 오버헤드가 증가할 것이기 때문이다.

그러나 실패했을 때 롤백과 같은 처리가 필요하다면 읽기/쓰기 쿼리가 한 문장만 있더라도 트랜잭션을 걸어야 하므로, 비지니스 요구사항에 알맞게 설계하는 것이 필요하다.
